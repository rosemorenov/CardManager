@page
@model CardManager.Pages.Decks.AddCardModel

<div class="container mt-4">

    <!-- Page Title -->
    <h2 class="text-primary">Add Card to Deck</h2>

    <!-- Display the deck name that the user is adding a card to -->
    <h5 class="mb-4">Deck: @Model.Deck?.DeckName</h5>

    <!-- This form allows the user to pick a card from the dropdown list.
         When submitted, it triggers the "ShowDetails" handler to display
         the information for the selected card.-->
    <form method="post" asp-page-handler="ShowDetails">

        <!-- Pass the DeckId back to the server on POST -->
        <input type="hidden" name="DeckId" value="@Model.DeckId" />

        <div class="mb-3">
            <label class="form-label">Choose a Card:</label>

            <!-- Dropdown list of all available cards -->
            <select name="SelectedCardId" class="form-select">
                <option value="">-- Select --</option>

                @foreach (var card in Model.AllCards)
                {
                    <option value="@card.CardId">
                        @card.Name (@card.CardSet)
                    </option>
                }
            </select>
        </div>

        <!-- Button that triggers "ShowDetails" to display card details -->
        <button class="btn btn-primary">Show Details</button>
    </form>

    <!-- Only shown when a card is selected and CardPreview is not null. Displays image and metadata about the card. -->
    @if (Model.CardPreview != null)
    {
        <div class="card shadow-sm mt-4 p-3">

            <div class="row">

                <!-- Left Column: Card Image -->
                <div class="col-md-4">
                    <img src="~/images/@Model.CardPreview.ImageFileName"
                         class="img-fluid rounded border"
                         alt="@Model.CardPreview.Name" />
                </div>

                <!-- Right Column: Card Information -->
                <div class="col-md-8">
                    <h3>@Model.CardPreview.Name</h3>

                    <div class="row mt-3">

                        <!-- Card properties: set, type, subtype, power -->
                        <div class="col-sm-6">
                            <p><strong>Set:</strong> @Model.CardPreview.CardSet</p>
                            <p><strong>Type:</strong> @Model.CardPreview.CardType</p>
                            <p><strong>Subtype:</strong> @Model.CardPreview.SubType</p>
                            <p><strong>Power:</strong> @Model.CardPreview.Power</p>
                        </div>

                        <!-- Additional properties: rarity, mana cost, value -->
                        <div class="col-sm-6">
                            <p><strong>Rarity:</strong> @Model.CardPreview.Rarity</p>
                            <p><strong>Mana Cost:</strong> @Model.CardPreview.ManaCost</p>
                            <p><strong>Value:</strong> $@Model.CardPreview.Value</p>
                        </div>

                    </div>
                </div>
            </div>

            <!-- This form submits to the AddCard handler. Adds the selected card to the chosen deck. -->
            <form method="post" asp-page-handler="AddCard" class="mt-3">

                <!-- Keep DeckId and SelectedCardId for POST -->
                <input type="hidden" name="DeckId" value="@Model.DeckId" />
                <input type="hidden" name="SelectedCardId" value="@Model.CardPreview.CardId" />

                <!-- Add card to deck button -->
                <button class="btn btn-success">Add Card to Deck</button>

                <!-- Return to Deck Details page -->
                <a asp-page="./Details" asp-route-id="@Model.DeckId" class="btn btn-secondary ms-2">
                    Cancel
                </a>
            </form>

        </div>
    }
</div>